<% content_for :javascripts do %>

	<script>
    function merge_options(obj1,obj2){
      var obj3 = {};
      for (var attrname in obj1) { obj3[attrname] = obj1[attrname]; }
      for (var attrname in obj2) { obj3[attrname] = obj2[attrname]; }
      return obj3;
    }

	  var wcgStats = {
          total_xrp: '',
          total_hours: '',
          today: ''
        },
	      chinese = false;

      $.getJSON('/api/stats/global', function(stats) {
      	wcgStats = merge_options({
          total_xrp: '',
          total_hours: '',
          today: ''
        },stats);
        console.log(wcgStats);
      	if (chinese) {
      		setChinese(wcgStats);
      	} else {
      		setEnglish(wcgStats);
      	}
      });

      function setChinese (stats) {
      	var html = _.template($('#homeTemplateChinese').html(), wcgStats);
        $('#main').html(html);
      }

      function setEnglish (stats) {
      	var html = _.template($('#homeTemplate').html(),wcgStats);
        $('#main').html(html);
      }

      if (chinese) {
        $('header').html(_.template($('#headerTemplateChinese').html(),wcgStats));
      } else {
        $('header').html(_.template($('#headerTemplate').html(),wcgStats));
      }

      $(document).on('change:language', function(event, language) {
        if (language == 'chinese') {
          chinese = true;
          setChinese(wcgStats);
        } else {
          setEnglish(wcgStats);
        }
      })
	</script>
<% end %>
